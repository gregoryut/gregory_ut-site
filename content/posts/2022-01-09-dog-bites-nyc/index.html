---
title: Dog Bites NYC
author: gregory_ut
date: '2022-01-09'
slug: []
categories:
  - R
tags:
  - R Markdown
  - map
  - plot
  - ggplot2
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<div id="load-packages-and-data" class="section level2">
<h2>Load packages and data</h2>
<div id="you-can-get-the-data-from-here-httpsdata.cityofnewyork.ushealthdohmh-dog-bite-datarsgh-akpg" class="section level3">
<h3>you can get the data from here <a href="https://data.cityofnewyork.us/Health/DOHMH-Dog-Bite-Data/rsgh-akpg" class="uri">https://data.cityofnewyork.us/Health/DOHMH-Dog-Bite-Data/rsgh-akpg</a></h3>
<pre class="r"><code>library(RSocrata)
library(tidyverse)</code></pre>
<pre><code>## -- Attaching packages --------------------------------------- tidyverse 1.3.1 --</code></pre>
<pre><code>## v ggplot2 3.3.5     v purrr   0.3.4
## v tibble  3.1.6     v dplyr   1.0.7
## v tidyr   1.1.4     v stringr 1.4.0
## v readr   2.1.1     v forcats 0.5.1</code></pre>
<pre><code>## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(tigris)</code></pre>
<pre><code>## To enable 
## caching of data, set `options(tigris_use_cache = TRUE)` in your R script or .Rprofile.</code></pre>
<pre class="r"><code>library(sf)</code></pre>
<pre><code>## Linking to GEOS 3.9.1, GDAL 3.2.1, PROJ 7.2.1; sf_use_s2() is TRUE</code></pre>
<pre class="r"><code>library(here)</code></pre>
<pre><code>## here() starts at C:/Users/grish/Desktop/gregory_ut/gregory_ut-site</code></pre>
<pre class="r"><code>library(tmap)
library(rgdal)</code></pre>
<pre><code>## Loading required package: sp</code></pre>
<pre><code>## Please note that rgdal will be retired by the end of 2023,
## plan transition to sf/stars/terra functions using GDAL and PROJ
## at your earliest convenience.
## 
## rgdal: version: 1.5-28, (SVN revision 1158)
## Geospatial Data Abstraction Library extensions to R successfully loaded
## Loaded GDAL runtime: GDAL 3.2.1, released 2020/12/29
## Path to GDAL shared files: C:/Users/grish/Documents/R/win-library/4.1/sf/gdal
## GDAL binary built with GEOS: TRUE 
## Loaded PROJ runtime: Rel. 7.2.1, January 1st, 2021, [PJ_VERSION: 721]
## Path to PROJ shared files: C:/Users/grish/Documents/R/win-library/4.1/rgdal/proj
## PROJ CDN enabled: FALSE
## Linking to sp version:1.4-6
## To mute warnings of possible GDAL/OSR exportToProj4() degradation,
## use options(&quot;rgdal_show_exportToProj4_warnings&quot;=&quot;none&quot;) before loading sp or rgdal.
## Overwritten PROJ_LIB was C:/Users/grish/Documents/R/win-library/4.1/rgdal/proj</code></pre>
<pre class="r"><code>dog_bite_raw &lt;- 
  read.socrata(&quot;https://data.cityofnewyork.us/resource/rsgh-akpg.csv&quot;) %&gt;%
  as_tibble() %&gt;%
  filter(borough %in% c(&quot;Brooklyn&quot;, &quot;Manhattan&quot;, &quot;Queens&quot;, &quot;Bronx&quot;, &quot;Staten Island&quot;))</code></pre>
</div>
</div>
<div id="count-how-many-dog-bites-in-each-borough." class="section level2">
<h2>Count how many dog bites in each borough.</h2>
<pre class="r"><code>dog_bite_raw %&gt;%
  count(borough)</code></pre>
<pre><code>## # A tibble: 5 x 2
##   borough           n
##   &lt;chr&gt;         &lt;int&gt;
## 1 Bronx          1757
## 2 Brooklyn       2281
## 3 Manhattan      2354
## 4 Queens         2520
## 5 Staten Island   931</code></pre>
<pre class="r"><code>dog_bite_raw %&gt;%
  count()</code></pre>
<pre><code>## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1  9843</code></pre>
</div>
<div id="get-zip-code-data" class="section level2">
<h2>Get zip-code data</h2>
<pre class="r"><code># get nyc spatial boundaries zip codes
nyc &lt;- tigris::zctas(year = 2010, state = &quot;NY&quot;)</code></pre>
<pre><code>## ZCTAs can take several minutes to download.  To cache the data and avoid re-downloading in future R sessions, set `options(tigris_use_cache = TRUE)`</code></pre>
<pre><code>## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |                                                                      |   1%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |==                                                                    |   4%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |===                                                                   |   5%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |=====                                                                 |   8%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |=======                                                               |  11%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |=========                                                             |  14%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |============                                                          |  18%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |==============                                                        |  21%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |================                                                      |  24%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |=================                                                     |  25%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |===================                                                   |  28%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |=====================                                                 |  31%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |=======================                                               |  34%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |==========================                                            |  38%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |============================                                          |  41%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |==============================                                        |  44%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |===============================                                       |  45%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |=================================                                     |  48%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |===================================                                   |  51%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |=====================================                                 |  54%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |========================================                              |  58%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |==========================================                            |  59%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |==========================================                            |  61%
  |                                                                            
  |===========================================                           |  61%
  |                                                                            
  |===========================================                           |  62%
  |                                                                            
  |============================================                          |  62%
  |                                                                            
  |============================================                          |  63%
  |                                                                            
  |============================================                          |  64%
  |                                                                            
  |=============================================                         |  64%
  |                                                                            
  |=============================================                         |  65%
  |                                                                            
  |==============================================                        |  65%
  |                                                                            
  |==============================================                        |  66%
  |                                                                            
  |===============================================                       |  66%
  |                                                                            
  |===============================================                       |  67%
  |                                                                            
  |===============================================                       |  68%
  |                                                                            
  |================================================                      |  68%
  |                                                                            
  |================================================                      |  69%
  |                                                                            
  |=================================================                     |  69%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |=================================================                     |  71%
  |                                                                            
  |==================================================                    |  71%
  |                                                                            
  |==================================================                    |  72%
  |                                                                            
  |===================================================                   |  72%
  |                                                                            
  |===================================================                   |  73%
  |                                                                            
  |====================================================                  |  74%
  |                                                                            
  |====================================================                  |  75%
  |                                                                            
  |=====================================================                 |  75%
  |                                                                            
  |=====================================================                 |  76%
  |                                                                            
  |======================================================                |  77%
  |                                                                            
  |======================================================                |  78%
  |                                                                            
  |=======================================================               |  78%
  |                                                                            
  |=======================================================               |  79%
  |                                                                            
  |========================================================              |  79%
  |                                                                            
  |========================================================              |  80%
  |                                                                            
  |========================================================              |  81%
  |                                                                            
  |=========================================================             |  81%
  |                                                                            
  |=========================================================             |  82%
  |                                                                            
  |==========================================================            |  82%
  |                                                                            
  |==========================================================            |  83%
  |                                                                            
  |===========================================================           |  84%
  |                                                                            
  |===========================================================           |  85%
  |                                                                            
  |============================================================          |  85%
  |                                                                            
  |============================================================          |  86%
  |                                                                            
  |=============================================================         |  86%
  |                                                                            
  |=============================================================         |  87%
  |                                                                            
  |=============================================================         |  88%
  |                                                                            
  |==============================================================        |  88%
  |                                                                            
  |==============================================================        |  89%
  |                                                                            
  |===============================================================       |  89%
  |                                                                            
  |===============================================================       |  90%
  |                                                                            
  |===============================================================       |  91%
  |                                                                            
  |================================================================      |  91%
  |                                                                            
  |================================================================      |  92%
  |                                                                            
  |=================================================================     |  92%
  |                                                                            
  |=================================================================     |  93%
  |                                                                            
  |=================================================================     |  94%
  |                                                                            
  |==================================================================    |  94%
  |                                                                            
  |==================================================================    |  95%
  |                                                                            
  |===================================================================   |  95%
  |                                                                            
  |===================================================================   |  96%
  |                                                                            
  |====================================================================  |  97%
  |                                                                            
  |====================================================================  |  98%
  |                                                                            
  |===================================================================== |  98%
  |                                                                            
  |===================================================================== |  99%
  |                                                                            
  |======================================================================|  99%
  |                                                                            
  |======================================================================| 100%</code></pre>
<pre class="r"><code># filter for zipcodes in dog bite dataframe
nyc2 &lt;- nyc %&gt;%
  filter(ZCTA5CE10 %in% dog_bite_raw$zipcode)</code></pre>
</div>
<div id="quick-plot" class="section level2">
<h2>Quick plot</h2>
<pre class="r"><code>nyc2 &lt;- janitor::clean_names(nyc2)

head(dog_bite_raw)   </code></pre>
<pre><code>## # A tibble: 6 x 9
##   uniqueid dateofbite          species breed     age   gender spayneuter borough
##      &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;  
## 1        1 2015-01-02 00:00:00 DOG     &quot;Poodle,~ &quot;3&quot;   M      true       Brookl~
## 2        2 2015-01-02 00:00:00 DOG     &quot;HUSKY&quot;   &quot;&quot;    U      false      Brookl~
## 3        3 2015-01-02 00:00:00 DOG     &quot;&quot;        &quot;&quot;    U      false      Brookl~
## 4        4 2015-01-01 00:00:00 DOG     &quot;America~ &quot;6&quot;   M      false      Brookl~
## 5        5 2015-01-03 00:00:00 DOG     &quot;America~ &quot;1&quot;   M      false      Brookl~
## 6        6 2015-01-05 00:00:00 DOG     &quot;America~ &quot;1&quot;   F      false      Brookl~
## # ... with 1 more variable: zipcode &lt;chr&gt;</code></pre>
<pre class="r"><code># bar plot
dog_bite_raw %&gt;%
  group_by(borough) %&gt;%
  summarise(n = n()) %&gt;%
  ggplot(aes(borough, n, fill = borough)) +
  geom_col() +
  theme_bw()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<pre class="r"><code>glimpse(nyc)</code></pre>
<pre><code>## Rows: 1,794
## Columns: 12
## $ STATEFP10  &lt;chr&gt; &quot;36&quot;, &quot;36&quot;, &quot;36&quot;, &quot;36&quot;, &quot;36&quot;, &quot;36&quot;, &quot;36&quot;, &quot;36&quot;, &quot;36&quot;, &quot;36&quot;,~
## $ ZCTA5CE10  &lt;chr&gt; &quot;12205&quot;, &quot;12009&quot;, &quot;14804&quot;, &quot;14836&quot;, &quot;14536&quot;, &quot;10464&quot;, &quot;1047~
## $ GEOID10    &lt;chr&gt; &quot;3612205&quot;, &quot;3612009&quot;, &quot;3614804&quot;, &quot;3614836&quot;, &quot;3614536&quot;, &quot;361~
## $ CLASSFP10  &lt;chr&gt; &quot;B5&quot;, &quot;B5&quot;, &quot;B5&quot;, &quot;B5&quot;, &quot;B5&quot;, &quot;B5&quot;, &quot;B5&quot;, &quot;B5&quot;, &quot;B5&quot;, &quot;B5&quot;,~
## $ MTFCC10    &lt;chr&gt; &quot;G6350&quot;, &quot;G6350&quot;, &quot;G6350&quot;, &quot;G6350&quot;, &quot;G6350&quot;, &quot;G6350&quot;, &quot;G635~
## $ FUNCSTAT10 &lt;chr&gt; &quot;S&quot;, &quot;S&quot;, &quot;S&quot;, &quot;S&quot;, &quot;S&quot;, &quot;S&quot;, &quot;S&quot;, &quot;S&quot;, &quot;S&quot;, &quot;S&quot;, &quot;S&quot;, &quot;S&quot;,~
## $ ALAND10    &lt;dbl&gt; 40906445, 135241924, 144718714, 77612958, 47193482, 9070627~
## $ AWATER10   &lt;dbl&gt; 243508, 2168637, 232123, 131305, 425175, 236605, 3918, 0, 1~
## $ INTPTLAT10 &lt;chr&gt; &quot;+42.7187855&quot;, &quot;+42.6975663&quot;, &quot;+42.3172588&quot;, &quot;+42.5429182&quot;,~
## $ INTPTLON10 &lt;chr&gt; &quot;-073.8292399&quot;, &quot;-074.0355422&quot;, &quot;-077.8479358&quot;, &quot;-077.87819~
## $ PARTFLG10  &lt;chr&gt; &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;,~
## $ geometry   &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((-73.87052 4..., MULTIPOLYGON (~</code></pre>
<pre class="r"><code>glimpse(dog_bite_raw)</code></pre>
<pre><code>## Rows: 9,843
## Columns: 9
## $ uniqueid   &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, ~
## $ dateofbite &lt;dttm&gt; 2015-01-02, 2015-01-02, 2015-01-02, 2015-01-01, 2015-01-03~
## $ species    &lt;chr&gt; &quot;DOG&quot;, &quot;DOG&quot;, &quot;DOG&quot;, &quot;DOG&quot;, &quot;DOG&quot;, &quot;DOG&quot;, &quot;DOG&quot;, &quot;DOG&quot;, &quot;DO~
## $ breed      &lt;chr&gt; &quot;Poodle, Standard&quot;, &quot;HUSKY&quot;, &quot;&quot;, &quot;American Pit Bull Terrier~
## $ age        &lt;chr&gt; &quot;3&quot;, &quot;&quot;, &quot;&quot;, &quot;6&quot;, &quot;1&quot;, &quot;1&quot;, &quot;1&quot;, &quot;1&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;4&quot;, ~
## $ gender     &lt;chr&gt; &quot;M&quot;, &quot;U&quot;, &quot;U&quot;, &quot;M&quot;, &quot;M&quot;, &quot;F&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;U&quot;, &quot;U&quot;, &quot;U&quot;,~
## $ spayneuter &lt;chr&gt; &quot;true&quot;, &quot;false&quot;, &quot;false&quot;, &quot;false&quot;, &quot;false&quot;, &quot;false&quot;, &quot;false~
## $ borough    &lt;chr&gt; &quot;Brooklyn&quot;, &quot;Brooklyn&quot;, &quot;Brooklyn&quot;, &quot;Brooklyn&quot;, &quot;Brooklyn&quot;,~
## $ zipcode    &lt;chr&gt; &quot;11238&quot;, &quot;11249&quot;, NA, &quot;11221&quot;, &quot;11207&quot;, &quot;11209&quot;, &quot;11220&quot;, &quot;~</code></pre>
</div>
<div id="join-data-together" class="section level2">
<h2>Join data together</h2>
<pre class="r"><code># join to spatial data
dog_full &lt;- nyc2 %&gt;%
  rename(zipcode = zcta5ce10) %&gt;%
  full_join(dog_bite_raw, by = c(&quot;zipcode&quot; = &quot;zipcode&quot;))

# convert to character
dog_full$uniqueid &lt;- as.character(dog_full$uniqueid)

# summarise by zipcode
dogg &lt;- dog_full %&gt;%
  na.omit() %&gt;%
  group_by(zipcode) %&gt;%
  summarize(bites = n())</code></pre>
</div>
<div id="create-maps" class="section level2">
<h2>Create Maps</h2>
<pre class="r"><code>dogg %&gt;%
  ggplot(aes(fill = bites)) +
  geom_sf(lwd = 0.3) +
  scale_fill_gradient2() +
  labs(title = &quot;Dog Bites in New York City.&quot;,
       caption = &quot;Data: https://data.cityofnewyork.us/resource/rsgh-akpg.csv&quot;,
       fill = &quot;# Bites&quot;) +
  theme_minimal() +
  theme(panel.grid = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        plot.title = element_text(hjust = 0.5, size = 18, face = &quot;bold&quot;))</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<pre class="r"><code># similar version map with tmap
tm_shape(dogg) +
  tm_fill(&quot;bites&quot;,
          style = &quot;quantile&quot;,
          n = 5,
          title = &quot;Dog bites&quot;) +
  tm_borders(col = &quot;black&quot;,
             lwd = 0.3) +
  tm_layout(title = &quot;Dog Bites in New York City.&quot;,
            legend.outside = TRUE,
            legend.outside.position = &quot;left&quot;,
            title.fontface = &quot;bold&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-7-2.png" width="672" /></p>
</div>
